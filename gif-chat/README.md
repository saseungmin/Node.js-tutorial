# âœ” Web Socket ìœ¼ë¡œ ì‹¤ì‹œê°„ ë°ì´í„° ì „ì†¡
### ğŸ“Œ ì°¸ê³  ë¬¸ì„œ
> - ì›¹ ì†Œì¼“ ì„¤ëª… : https://ko.wikipedia.org/wiki/%EC%9B%B9%EC%86%8C%EC%BC%93
> - WS ê³µì‹ ë¬¸ì„œ : https://www.npmjs.com/package/ws
> - Socket.IO ê³µì‹ ë¬¸ì„œ : https://socket.io/

## ğŸŒˆ ì›¹ ì†Œì¼“ì´ë€?
- HTML5ì—ì„œ ìƒˆë¡œ ì¶”ê°€ëœ ìŠ¤í™ìœ¼ë¡œ ì‹¤ì‹œê°„ ì–‘ë°©í–¥ ë°ì´í„° ì „ì†¡ì„ ìœ„í•œ ê¸°ìˆ 
- WSë¼ëŠ” í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ì™€ ì„œë²„ê°€ WS í”„ë¡œí† ì½œì„ ì§€ì›í•˜ë©´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ì›¹ ì†Œì¼“ì´ ë‚˜ì˜¤ê¸° ì´ì „ì—ëŠ” HTTP ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ë°ì´í„° ì „ì†¡ì„ êµ¬í˜„í•˜ì˜€ë‹¤. (**í´ë§(polling)** ë°©ì‹)
- í´ë§ ë°©ì‹ì€ HTTPê°€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ í–¥í•˜ëŠ” ë‹¨ë°©í–¥ í†µì‹ ì´ë¯€ë¡œ ì£¼ê¸°ì ìœ¼ë¡œ ì„œë²„ì— ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸ê°€ ì—†ëŠ”ì§€ í™•ì¸í•˜ëŠ” ìš”ì²­ì„ ë³´ë‚´, ìˆë‹¤ë©´ ìƒˆë¡œìš´ ë‚´ìš©ì„ ê°€ì ¸ì˜¤ëŠ” ë‹¨ìˆœ ë¬´ì‹í•œ ë°©ë²•ì´ë‹¤.
- ì›¹ ì†Œì¼“ ì—°ê²°ì´ ì´ë£¨ì–´ì§€ê³  ë‚˜ë©´ ê·¸ ë‹¤ìŒë¶€í„°ëŠ” ê³„ì† ì—°ê²°ëœ ìƒíƒœë¡œ ìˆì–´ ë”°ë¡œ ì—…ë°ì´íŠ¸ê°€ ìˆëŠ”ì§€ ìš”ì²­ì„ ë³´ë‚¸ í•„ìš”ê°€ ì—†ë‹¤.
- ë˜í•œ HTTP í”„ë¡œí† ì½œê³¼ í¬íŠ¸ë¥¼ ê³µìœ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë‹¤ë¥¸ í¬íŠ¸ì— ì—°ê²°í•  í•„ìš”ë„ ì—†ë‹¤.
> - ì°¸ê³ ë¡œ **ì„œë²„ì„¼íŠ¸ ì´ë²¤íŠ¸(Server Sent Events, ì´í•˜ SSE)** ë¼ëŠ” ê¸°ìˆ ë„ ë“±ì¥.
> - `EventSource`ë¼ëŠ” ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ìŒì— í•œ ë²ˆë§Œ ì—°ê²°í•˜ë©´ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì— ì§€ì†ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ì¤€ë‹¤.
> - ì›¹ ì†Œì¼“ê³¼ ë‹¤ë¥¸ ì ì€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œëŠ” ë°ì´í„°ë¥¼ ë³´ë‚¼ ìˆ˜ ì—†ë‹¤ëŠ” ì ìœ¼ë¡œ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ëŠ” ë‹¨ë°©í–¥ í†µì‹ ì´ë‹¤.
> - í•˜ì§€ë§Œ ì˜ˆë¥¼ ë“¤ì–´ ì£¼ì‹ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ë‚˜ SNSì—ì„œ ìƒˆë¡œìš´ ê²Œì‹œë¬¼ ê°€ì ¸ì˜¤ê¸° ë“± êµ³ì´ ì–‘ë°©í–¥ í†µì‹ ì„ í•  í•„ìš”ê°€ ì—†ëŠ” ê²½ìš°ì— ì„œë²„ì—ì„œ ì¼ë°©ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë‚´ë ¤ì¤„ ë•Œ ì‚¬ìš©í•œë‹¤.
- `Socket.io`ëŠ” ì›¹ ì†Œì¼“ì„ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

## ğŸŒˆ ws ëª¨ë“ˆë¡œ ì›¹ ì†Œì¼“ ì‚¬ìš©
1. `npm init` í›„ `npm i`
<pre>
  "dependencies": {
    "connect-flash": "^0.1.1",
    "cookie-parser": "^1.4.5",
    "dotenv": "^8.2.0",
    "express": "^4.17.1",
    "express-session": "^1.17.1",
    "morgan": "^1.10.0",
    "pug": "^3.0.0",
    "socket.io": "^2.3.0",
    "ws": "^7.3.0"
  },
  "devDependencies": {
    "nodemon": "^2.0.4"
  }
</pre>
2. `.env`ì— `COOKIE_SECRET=[ì¿ í‚¤ ë¹„ë°€í‚¤]` ì‘ì„±
3. `app.js`ì‘ì„± ([ì£¼ì„ ì°¸ê³ ](https://github.com/saseungmin/Node.js-tutorial/blob/master/gif-chat/app.js))
4. `routes/index.js` ì‘ì„±
5. `ws` ëª¨ë“ˆì„ ì„¤ì¹˜í•˜ì—¬ ë…¸ë“œì— ì›¹ ì†Œì¼“ êµ¬í˜„
<pre>
$ npm i ws
</pre>
6. `app.js`ì— ì›¹ ì†Œì¼“ì„ ìµìŠ¤í”„ë ˆìŠ¤ ì„œë²„ì— ì—°ê²°í•˜ëŠ” ë¶€ë¶„ ì‘ì„±
7. ì›¹ ì†Œì¼“ ë¡œì§ì´ ë“¤ì–´ìˆì€ `socket.js` ì‘ì„± ([ì£¼ì„ ì°¸ê³ ](https://github.com/saseungmin/Node.js-tutorial/blob/master/gif-chat/socket.js))
8. ì–‘ë°©í–¥ í†µì‹ ì´ê¸° ë•Œë¬¸ì— script ë¶€ë¶„ì— ì›¹ì†Œì¼“ `views/index.pug` ì‘ì„± (í´ë¼ì´ì–¸íŠ¸ ë¶€ë¶„, [ì£¼ì„ ì°¸ê³ ](https://github.com/saseungmin/Node.js-tutorial/tree/master/gif-chat/views))

## ğŸŒˆ Socket.IO ì‚¬ìš©
- êµ¬í˜„í•˜ê³ ì í•˜ëŠ” ì„œë¹„ìŠ¤ê°€ ë³µì¡í•´ì§€ë©´ Socket.IOë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í¸í•˜ë‹¤.
<pre>
$ npm i socket.io
</pre>
1. `socketio.js` ì‘ì„±([ì£¼ì„ í™•ì¸](https://github.com/saseungmin/Node.js-tutorial/blob/master/gif-chat/socketio.js))
2. `index.pug` ìˆ˜ì •([ì£¼ì„ í™•ì¸](https://github.com/saseungmin/Node.js-tutorial/tree/master/gif-chat/views))
- Socket.IOëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¨¼ì € **í´ë§ ë°©ì‹ìœ¼ë¡œ ì„œë²„ì™€ ì—°ê²°**í•œë‹¤.
- ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì½”ë“œì—ì„œ HTTP í”„ë¡œí† ì½œì„ ì‚¬ìš©í•œ ê²ƒì´ë‹¤.

![polling](./img/1.PNG)
- í´ë§ ì—°ê²° í›„, ì›¹ ì†Œì¼“ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ë©´ ì›¹ ì†Œì¼“ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ í•œë‹¤.
- ì›¹ ì†Œì¼“ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ëŠ” í´ë§ ë°©ì‹ìœ¼ë¡œ, ì›¹ ì†Œì¼“ì„ ì§€ì›í•˜ëŠ” ë¸Œë¼ìš°ì €ëŠ” ì›¹ ì†Œì¼“ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ê²ƒì´ë‹¤.
- ì²˜ìŒë¶€í„° ì›¹ ì†Œì¼“ë§Œì„ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì˜µì…˜ì„ ìˆ˜ì •í•´ì¤€ë‹¤.
<pre>
var socket = io.connect('http://localhost:8005',{
    // ì„œë²„ì˜ path ì˜µì…˜ê³¼ ë™ì¼í•´ì•¼ í•œë‹¤.
    path:'/socket.io',
    <b>transports:['websocket']</b>
});
</pre>

![websocket](./img/2.PNG)